<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Code-tekenen Generator</title>

  <!-- Bestaande CSS blijft buiten /pro/, dus √©√©n niveau hoger -->
  <link rel="stylesheet" href="../coderen.css" />

  <!-- jsPDF (zoals origineel) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Belangrijk: alle relatieve paden resolven nu naar /pro/ -->
  <base href="/pro/">

  <!-- Header-overrides zodat titel altijd gecentreerd staat en knoppen smal blijven -->
  <style>
    .pro-header {
      position: relative;
      background-color: #3f7fbf;
      padding: 10px 12px;
      color: #fff;
      min-height: 56px;
      border-bottom: 0;
    }
    .pro-header .back-link {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      text-decoration: none;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      background: #5a9fd4;
      padding: 6px 10px;
      border-radius: 6px;
      display: inline-block;
      width: auto !important;
      white-space: nowrap;
    }
    .pro-header .title {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0;
      text-align: center;
      font-size: 26px;
      font-weight: 800;
      letter-spacing: .2px;
      white-space: nowrap;
      pointer-events: none; /* voorkomt klik-issues bij overlappende zones */
    }
    .pro-header #logoutBtn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: #5a9fd4;
      color: #fff;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      display: inline-block;
      width: auto !important;
      max-width: none !important;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <header class="pro-header">
    <a href="app.html" class="back-link">&larr; Terug naar menu</a>
    <h1 class="title">Code-tekenen Generator</h1>
    <button id="logoutBtn">Uitloggen</button>
  </header>

  <div id="main-content">
    <div id="left-panel">
      <div class="control-group">
        <h3>Instructies</h3>
        <ol>
          <li>Gebruik <strong>Startpunt</strong> üìç om te beginnen.</li>
          <li>Gebruik <strong>Lijn</strong> om de code-route te tekenen.</li>
          <li>Plaats details met de andere tools.</li>
          <li>Gebruik <strong>Verplaats</strong> üñêÔ∏è om details te selecteren, verslepen, draaien, vergroten en verwijderen (Delete/Backspace).</li>
          <li>Klik op <strong>Genereer Code</strong>.</li>
        </ol>
      </div>

      <div class="control-group">
        <h3>Gereedschap</h3>
        <div id="tool-palette">
          <button class="tool-btn selected" data-tool="start">Startpunt üìç</button>
          <button class="tool-btn" data-tool="line">Lijn (voor code)</button>
          <button class="tool-btn" data-tool="freehand">Vrije Lijn ‚úçÔ∏è</button>
          <button class="tool-btn" data-tool="eye">Oog üëÅÔ∏è</button>
          <button class="tool-btn" data-tool="nose">Neus üëÉ</button>
          <button class="tool-btn" data-tool="mouth">Mond üëÑ</button>
          <button class="tool-btn" data-tool="triangle">Driehoek ‚ñ≥</button>
          <button class="tool-btn" data-tool="coloredLine">Gekleurde Lijn</button>
          <button class="tool-btn" data-tool="move">Verplaats üñêÔ∏è</button>
          <button class="tool-btn" data-tool="eraser">Gum üßº</button>
        </div>
        <div class="tool-setting" style="margin-top: 8px;">
          <input type="checkbox" id="fillTriangleCheckbox" style="width:auto;">
          <label for="fillTriangleCheckbox">Driehoek opvullen</label>
        </div>
        <div class="tool-setting" style="margin-top: 12px;">
          <label for="lineColor">Lijnkleur:</label>
          <input type="color" id="lineColor" value="#E53935">
        </div>
        <div class="tool-setting">
          <label for="featureColor">Detailkleur:</label>
          <input type="color" id="featureColor" value="#000000">
        </div>
      </div>

      <div class="control-group">
        <h3>Raster Grootte</h3>
        <div class="tool-setting">
          <label for="gridWidth">Kolommen:</label>
          <input type="number" id="gridWidth" value="25" min="5" max="100">
        </div>
        <div class="tool-setting">
          <label for="gridHeight">Rijen:</label>
          <input type="number" id="gridHeight" value="30" min="5" max="100">
        </div>
        <button id="resetGridBtn">Nieuw Leeg Raster</button>

        <div class="grid-modifiers">
          <button id="addColLeftBtn" title="Kolom links toevoegen">+</button>
          <span>Kolom</span>
          <button id="removeColLeftBtn" title="Kolom links verwijderen">-</button>
          <button id="removeColRightBtn" title="Kolom rechts verwijderen">-</button>
          <button id="addColRightBtn" title="Kolom rechts toevoegen">+</button>
        </div>
        <div class="grid-modifiers">
          <button id="addRowTopBtn" title="Rij boven toevoegen">+</button>
          <span>Rij</span>
          <button id="removeRowTopBtn" title="Rij boven verwijderen">-</button>
          <button id="removeRowBottomBtn" title="Rij onder verwijderen">-</button>
          <button id="addRowBottomBtn" title="Rij onder toevoegen">+</button>
        </div>
      </div>

      <div class="control-group">
        <h3>Acties</h3>
        <button id="generateBtn">Genereer Code</button>
        <button id="undoCodeBtn">Code Stap Ongedaan Maken ‚Ü©Ô∏è</button>
        <button id="clearBtn">Wis Tekening</button>
      </div>

      <div id="meldingContainer" class="melding"></div>
    </div>

    <div id="center-panel">
      <canvas id="drawingCanvas"></canvas>
    </div>

    <div id="right-panel">
      <div class="control-group">
        <h3>Gegenereerd Werkblad</h3>
        <div id="output-container">
          <div id="instructions-header">Code:</div>
          <div id="instructions-output"></div>
          <canvas id="worksheetCanvas"></canvas>
        </div>
        <button id="downloadPdfBtn" disabled>Download Werkblad als PDF</button>
      </div>

      <div class="control-group">
        <h3>Tekening</h3>
        <button id="saveDrawingBtn">Tekening Opslaan</button>
        <button id="loadDrawingBtn">Tekening Laden</button>
        <input type="file" id="loadDrawingInput" accept=".json" style="display:none;">
        <button id="catalogBtn">Catalogus</button>
      </div>
    </div>
  </div>

  <!-- Catalogus-modal -->
  <div id="catalogModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <div id="modal-header">
        <button id="backToThemesBtn" style="display:none;">&leftarrow; Terug</button>
        <h2 id="modal-title">Catalogus</h2>
      </div>
      <div id="catalog-themes" class="catalog-view"></div>
      <div id="catalog-choices" class="catalog-view" style="display:none;"></div>
    </div>
  </div>

  <!-- PRO-mapper: herschrijft alle 'catalogus/' verwijzingen naar 'coderen_afbeeldingen/' -->
  <script>
    (function () {
      // Intercept fetch() en herschrijf paden
      const origFetch = window.fetch;
      window.fetch = function(input, init) {
        let url = typeof input === 'string' ? input : (input && input.url);
        if (url && url.includes('catalogus/')) {
          const newUrl = url.replace(/(^|\/)catalogus\//g, '$1coderen_afbeeldingen/');
          input = (typeof input === 'string') ? newUrl : new Request(newUrl, input);
        }
        return origFetch.call(this, input, init);
      };

      // Herschrijf <img src> voor bestaande, nieuwe √©n gewijzigde nodes
      function remapSrcIfNeeded(imgEl) {
        if (!imgEl) return;
        const src = imgEl.getAttribute && imgEl.getAttribute('src');
        if (!src) return;
        if (src.includes('catalogus/')) {
          imgEl.setAttribute('src', src.replace(/(^|\/)catalogus\//g, '$1coderen_afbeeldingen/'));
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('img').forEach(remapSrcIfNeeded);
      });

      const mo = new MutationObserver((mutations) => {
        for (const m of mutations) {
          if (m.type === 'attributes' && m.attributeName === 'src' && m.target.tagName === 'IMG') {
            remapSrcIfNeeded(m.target);
          }
          m.addedNodes.forEach((node) => {
            if (node.nodeType !== 1) return;
            if (node.tagName === 'IMG') remapSrcIfNeeded(node);
            node.querySelectorAll && node.querySelectorAll('img').forEach(remapSrcIfNeeded);
          });
        }
      });
      mo.observe(document.documentElement, { childList: true, subtree: true, attributes: true, attributeFilter: ['src'] });

      // Uitloggen: lokale tokens wissen + serverlogout, daarna naar login
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('#logoutBtn');
        if (!btn) return;
        try { localStorage.removeItem('authToken'); } catch {}
        try { localStorage.removeItem('refreshToken'); } catch {}
        fetch('/auth/logout', { method: 'POST', credentials: 'include' })
          .catch(() => {})
          .finally(() => { window.location.href = '/login.html'; });
      });
    })();
  </script>

  <!-- Bestaande logica blijft buiten /pro/, dus √©√©n niveau hoger -->
  <script src="../coderen.js"></script>
</body>
</html>







