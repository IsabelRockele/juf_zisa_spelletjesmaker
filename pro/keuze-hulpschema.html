<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <base href="/juf_zisa_spelletjesmaker/pro/">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kies Hulpschema</title>
  <link rel="stylesheet" href="../keuze-hulpschema.css">
</head>
<body>
  <div class="panel">
    <div id="stap1" class="stap">
      <a href="index.html" class="menu-btn">Keuzemenu</a>
      <h1>Kies waarmee je wilt oefenen</h1>
      <div class="button-container">
        <button id="naar-stap2-btn" class="choice-btn">Tot 100</button>
      <a href="Tot_1000.html" class="choice-btn">Tot 1000</a>
        </div>
    </div>

    <div id="stap2" class="stap" style="display: none;">
      <button id="terug-naar-stap1-btn" class="menu-btn">Terug</button>
      <h1>Oefenen tot 100</h1>
      <div class="button-container">
        <a href="./plus100.html?terug=keuze-hulpschema.html#stap2" class="choice-btn plus">+</a>
        <a href="./min100.html?terug=keuze-hulpschema.html#stap2" class="choice-btn min">-</a>
      </div>
    </div>
  </div>

  <script>
    const stap1 = document.getElementById('stap1');
    const stap2 = document.getElementById('stap2');
    const naarStap2Btn = document.getElementById('naar-stap2-btn');
    const terugNaarStap1Btn = document.getElementById('terug-naar-stap1-btn');

    function toonJuisteStap() {
      if (window.location.hash === '#stap2') {
        stap1.style.display = 'none';
        stap2.style.display = 'block';
      } else {
        stap1.style.display = 'block';
        stap2.style.display = 'none';
      }
    }
    document.addEventListener('DOMContentLoaded', toonJuisteStap);

    naarStap2Btn.addEventListener('click', () => {
      stap1.style.display = 'none';
      stap2.style.display = 'block';
    });
    terugNaarStap1Btn.addEventListener('click', () => {
      stap2.style.display = 'none';
      stap1.style.display = 'block';
      history.pushState("", document.title, window.location.pathname + window.location.search);
    });
  </script>

  <!-- PRO init eerst -->
  <script src="./device-id.js"></script>
  <script type="module" src="./guard.js"></script>

  <!-- QR-paneel voor leerkracht (compact, rechtsonder) -->
<!-- QR-paneel voor leerkracht (compact, rechtsonder) -->
<div id="kid-qr-panel" style="
  position:fixed; right:14px; bottom:14px; z-index:9999;
  background:#fff; border:1px solid #e3e8f5; border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.08); padding:12px; width: 280px;">
  <div style="font:600 14px system-ui; color:#123b72; margin-bottom:8px;">
    QR voor thuisgebruik
  </div>
  <button id="gen-qr"
    style="width:100%; padding:10px; border-radius:9px; border:2px solid #3f7fbf; background:#fff; color:#275ea8; font-weight:800; cursor:pointer;">
    Maak QR
  </button>

  <div id="qr-wrap" style="display:none; margin-top:10px; text-align:center;">
    <div id="qr-box" style="display:inline-block; padding:6px; background:#fff; border:1px solid #eef3ff;"></div>
    <a id="qr-dl" download="hulpschema-qr.png"
       style="display:block; margin-top:8px; font:600 13px system-ui; color:#275ea8; text-decoration:underline; cursor:pointer;">
       Download als PNG
    </a>
    <div id="qr-exp" style="margin-top:6px; font:12px system-ui; color:#566;">
      Geldig t/m: …
    </div>
  </div>

  <!-- ⬇️ UITLEG HIER PLAKKEN (onder het QR-blok) -->
  <div id="qr-uitleg" style="display:none; margin-top:8px; font-size:0.95rem; line-height:1.35;">
    <strong>Tip voor leerkrachten</strong><br>
    Druk de QR-code af en hang ze zichtbaar op in de klas en/of kleef ze in de klasagenda.<br>
    De QR blijft <em>één jaar</em> geldig.<br>
    (Een nieuwe QR aanmaken maakt de vorige <em>niet</em> onbruikbaar.)
  </div>
</div>


    <!-- QR generator lib (lichtgewicht) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
  <!-- jsPDF voor PDF-export -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Aanroep naar je Cloud Function 'createKidLink' — NA guard.js! -->
<script type="module">
// --- VERVANG ALLEEN DE FUNCTIE makePdfFromQr DOOR DEZE ---

async function makePdfFromQr(url, copies = 20) {
  if (!url) return;
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'a4' });

  // Pagina-afmetingen (A4 liggend)
  const pageW = 297, pageH = 210;

  // Layoutinstellingen
  const margin   = 10;   // buitenmarge rondom
  const cols     = 2;
  const rows     = 5;    // 10 kaartjes per pagina
  const gutterX  = 8;    // horizontale ruimte tussen kolommen
  const gutterY  = 6;    // verticale ruimte tussen rijen

  // Kaartafmetingen (vak)
  const cardW = (pageW - 2*margin - gutterX*(cols-1)) / cols;
  const cardH = (pageH - 2*margin - gutterY*(rows-1)) / rows;

  const title = 'Hulpschema rekenen';

  // Binnenmarges in elk vak
  const padTop    = 6;   // ruimte boven titel
  const padSides  = 6;   // links/rechts
  const padUnderT = 4;   // ruimte tussen titel en QR

  // Tekst-instelling voor titel
  const titleSize = 11;  // niet te groot
  const titleLine = 5;   // visuele lijnhoogte (mm)

  // Bepaal beschikbare ruimte voor QR in het vak
  const availW = cardW - 2*padSides;
  const availH = cardH - padTop - titleLine - padUnderT - 6; // 6mm bodemruimte

  // QR-zijde: kies de kleinste van (beschikbare breedte/hoogte)
  // en clamp tussen 36–48 mm: goed scanbaar, niet reusachtig.
  const qrSize = Math.max(36, Math.min(48, Math.min(availW, availH)));

  // Hoge-res QR één keer genereren en hergebruiken
  const qrPng = await makeQrDataUrl(url, 900);

  // Dunne lijn voor de vakranden
  doc.setDrawColor(60);
  doc.setLineWidth(0.2);

  for (let i = 0; i < copies; i++) {
    if (i > 0 && i % (cols*rows) === 0) {
      doc.addPage();
    }

    const slot = i % (cols*rows);
    const r = Math.floor(slot / cols);
    const c = slot % cols;

    const x = margin + c * (cardW + gutterX);
    const y = margin + r * (cardH + gutterY);

    // 1) VAK: wit opvullen + rand
    doc.setFillColor(255, 255, 255);
    doc.rect(x, y, cardW, cardH, 'FD'); // Fill & Draw

    // 2) TITEL
    const centerX = x + cardW / 2;
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(titleSize);
    doc.text(title, centerX, y + padTop + titleSize*0.35, { align: 'center' });

    // 3) QR in het vak, gecentreerd
    const qrX = centerX - qrSize / 2;
    const qrY = y + padTop + titleLine + padUnderT;
    doc.addImage(qrPng, 'PNG', qrX, qrY, qrSize, qrSize);
  }

  doc.save('hulpschema-qr.pdf');
}
// --- EINDE vervanging ---
</script>

</body>
</html>
